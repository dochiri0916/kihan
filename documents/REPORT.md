# `null = 단건` 정책 검토 보고서

## 결론
`RECURRING(반복 규칙) = null`을 단건으로 해석하는 정책은 **가능하지만, 단독 기준으로는 권장하지 않음**.  
실무에서는 `반복 규칙`과 `마감일`을 함께 검증하는 **명시적 판별 규칙**으로 운영하는 것이 더 안전하다.

## 왜 단독 기준이 위험한가
1. `null`은 보통 “값 미입력/누락”도 의미해서, 의도된 단건과 클라이언트 버그를 구분하기 어렵다.
2. API 진화 시 필드가 늘어나면(예: 커스텀 주기, 시간대), `null` 기반 암묵 규칙이 깨지기 쉽다.
3. 운영 중 장애 분석에서 “사용자 의도” 추적이 어려워진다.

## 장점
1. 요청 JSON이 간결해진다.
2. 클라이언트 구현이 단순해진다(타입 필드 제거 가능).

## 권장 모델
`type` 필드를 없애더라도 아래처럼 **구조적 규칙**을 고정하는 것이 좋다.

1. 단건: `recurrenceRule == null` 이고 `dueDate != null`
2. 반복: `recurrenceRule != null` 이고 `dueDate == null`
3. 둘 다 `null`이면 서버가 기본값으로 단건 생성 시 `dueDate = today`를 채움(정책 허용 시)

핵심은 `null = 단건`이 아니라, `recurrenceRule`/`dueDate`의 조합으로 유효성을 강제하는 것이다.

## 질문하신 정책(`RECURRING null` + `endDate null` => 당일) 평가
이 정책은 UX 측면에서 빠른 입력에는 유리하지만, 다음 보완이 필요하다.

1. 서버 로그에 “기본값으로 today 적용” 여부를 남겨야 한다.
2. API 문서에 자동 보정 규칙을 명시해야 한다.
3. 클라이언트 UI에 당일 자동 설정 안내가 있어야 오입력 오해를 줄일 수 있다.

## 최종 권고
- 정책 채택 가능: **예**
- 단, 운영 안정성을 위해 다음을 함께 적용: **명시적 조합 검증 + 기본값 적용 로그 + 문서 명시**

---

## 리뷰: 대기업 실무 관점 비교

### A안: `type` 필드 명시 (현재 커밋된 코드)
### B안: `recurrenceRule` null 여부로 추론 (현재 스테이징된 변경)

---

### 1. 대기업 실무에서는 B안(구조 기반 추론)이 주류

카카오·네이버·토스 등 국내 대형 서비스와 Google Calendar·Stripe Billing 등 해외 서비스 모두 **"구조가 타입을 결정한다"** 패턴을 쓴다. `type` 필드를 별도로 받으면 클라이언트가 `type=ONE_TIME`인데 `recurrenceRule`을 같이 보내는 **불일치 상태**를 서버가 매번 검증해야 한다. 필드 조합으로 타입이 유일하게 결정되면 이 검증 자체가 불필요해진다.

**결론: B안이 실무적으로 더 현대적이다.**

### 2. 단, `type`을 완전히 없애지 말고 응답 전용으로 유지하는 게 실무 표준

요청에서 `type`을 제거하되, **응답 DTO에는 `type`을 계산해서 내려주는 것**이 대기업 공통 패턴이다. 클라이언트가 조건 분기할 때 `response.recurrenceRule != null`보다 `response.type == "RECURRING"`이 가독성과 유지보수에서 낫다. 현재 `DeadlineResponse`에 `type`이 이미 있으므로 이 구조는 맞다.

### 3. 둘 다 `null`일 때 자동 보정은 실무에서 지양

보고서 권장 모델 3번(`둘 다 null → dueDate = today`)은 대기업 코드 리뷰에서 거의 통과하지 못한다. **"암묵적 기본값은 장애의 씨앗"**이라는 원칙 때문이다. 토스·카카오페이 같은 핀테크는 물론이고 일반 서비스에서도 유효하지 않은 입력은 `400`으로 거부하고, 기본값이 필요하면 **클라이언트가 명시적으로 보내도록** 강제한다.

### 4. `DeadlineType` enum 삭제 여부

enum 자체는 삭제하지 않는 게 맞다. 도메인 내부에서 분기 로직(`isRecurring()`)에 사용하고, 응답에도 내려주므로 **도메인 개념으로서의 enum은 유지**하되, **엔티티 컬럼과 요청 DTO에서만 제거**하는 것이 현재 B안의 올바른 적용 방향이다. 현재 스테이징된 코드가 이 방향과 일치한다.

### 5. 현재 코드 상태 판정

| 항목 | 현재 상태 | 실무 적합성 |
|------|-----------|-------------|
| 요청에서 `type` 제거 | 스테이징 완료 | 적합 |
| `pattern` 유무로 타입 추론 | `resolveType()` 구현됨 | 적합 |
| 응답에 `type` 유지 | `DeadlineResponse`에 존재 | 적합 |
| 둘 다 `null` 시 거부 | 엔티티 `validate()`에서 예외 | 적합 |
| `DeadlineType` enum 존재 | 유지 중 | 적합 |
| 도메인 테스트 | 아직 이전 시그니처 사용 | **수정 필요** |

### 최종 판정
현재 스테이징된 B안 방향이 대기업 실무 기준에 부합한다. 테스트 코드만 새 시그니처에 맞춰 수정하면 된다.
